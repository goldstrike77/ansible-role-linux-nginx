---
nginx_conf_scripts:
  - { src: 'nginx.logrotate.j2', dest: '/etc/logrotate.d/nginx' }
  - { src: 'nginx.conf.j2',      dest: '{{ ngx_conf_path }}/nginx.conf' }
  - { src: 'nginx.service.j2',   dest: '/lib/systemd/system/nginx.service' }
  - { src: 'default.conf.j2',    dest: '{{ ngx_conf_path }}/conf.d/default.conf' }
  - { src: 'security.conf.j2',   dest: '{{ ngx_conf_path }}/security.conf' }

ngx_ssl_protocols_modern:
  protocols: 'TLSv1.2'
  ciphers: 'ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256'

ngx_ssl_protocols_intermediate:
  protocols: 'TLSv1 TLSv1.1 TLSv1.2'
  ciphers: 'ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA:ECDHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES256-SHA:ECDHE-ECDSA-DES-CBC3-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:DES-CBC3-SHA:!DSS'

ngx_ssl_protocols_old:
  protocols: 'SSLv3 TLSv1 TLSv1.1 TLSv1.2'
  ciphers: 'ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-DSS-AES128-GCM-SHA256:kEDH+AESGCM:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-DSS-AES128-SHA256:DHE-RSA-AES256-SHA256:DHE-DSS-AES256-SHA:DHE-RSA-AES256-SHA:ECDHE-RSA-DES-CBC3-SHA:ECDHE-ECDSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:AES:DES-CBC3-SHA:HIGH:SEED:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!RSAPSK:!aDH:!aECDH:!EDH-DSS-DES-CBC3-SHA:!KRB5-DES-CBC3-SHA:!SRP'

ngx_kernel_parameters:
  - { variable: 'kernel.msgmax',                             value: '65536' }
  - { variable: 'kernel.msgmnb',                             value: '65536' }
  - { variable: 'kernel.pid_max',                            value: '65536' }
  - { variable: 'kernel.randomize_va_space',                 value: '1' }
  - { variable: 'net.core.default_qdisc',                    value: 'fq' }
  - { variable: 'net.core.netdev_max_backlog',               value: '64000' }
  - { variable: 'net.core.rmem_default',                     value: '67108864' }
  - { variable: 'net.core.rmem_max',                         value: '67108864' }
  - { variable: 'net.core.wmem_default',                     value: '67108864' }
  - { variable: 'net.core.wmem_max',                         value: '67108864' }
  - { variable: 'net.ipv4.conf.all.accept_redirects',        value: '0' }
  - { variable: 'net.ipv4.conf.all.accept_source_route',     value: '0' }
  - { variable: 'net.ipv4.conf.all.log_martians',            value: '0' }
  - { variable: 'net.ipv4.conf.all.rp_filter',               value: '1' }
  - { variable: 'net.ipv4.conf.all.secure_redirects',        value: '0' }
  - { variable: 'net.ipv4.conf.all.send_redirects',          value: '0' }
  - { variable: 'net.ipv4.conf.default.accept_redirects',    value: '0' }
  - { variable: 'net.ipv4.conf.default.accept_source_route', value: '0' }
  - { variable: 'net.ipv4.conf.default.secure_redirects',    value: '0' }
  - { variable: 'net.ipv4.conf.default.send_redirects',      value: '0' }
  - { variable: 'net.ipv4.ip_local_port_range',              value: '1024 65535' }
  - { variable: 'net.ipv4.neigh.default.gc_stale_time',      value: '7200' }
  - { variable: 'net.ipv4.neigh.default.gc_thresh1',         value: '225280' }
  - { variable: 'net.ipv4.neigh.default.gc_thresh2',         value: '450560' }
  - { variable: 'net.ipv4.neigh.default.gc_thresh3',         value: '450560' }
  - { variable: 'net.ipv4.tcp_congestion_control',           value: 'cubic' }
  - { variable: 'net.ipv4.tcp_dsack',                        value: '0' }
  - { variable: 'net.ipv4.tcp_fack',                         value: '0' }
  - { variable: 'net.ipv4.tcp_fin_timeout' ,                 value: '10' }
  - { variable: 'net.ipv4.tcp_keepalive_intvl',              value: '30' }
  - { variable: 'net.ipv4.tcp_keepalive_probes',             value: '5' }
  - { variable: 'net.ipv4.tcp_max_orphans',                  value: '262144' }
  - { variable: 'net.ipv4.tcp_max_syn_backlog',              value: '3240000' }
  - { variable: 'net.ipv4.tcp_max_tw_buckets',               value: '5880000' }
  - { variable: 'net.ipv4.tcp_rmem',                         value: '4096 87380 33554432' }
  - { variable: 'net.ipv4.tcp_sack',                         value: '0' }
  - { variable: 'net.ipv4.tcp_slow_start_after_idle',        value: '0' }
  - { variable: 'net.ipv4.tcp_syn_retries',                  value: '3' }
  - { variable: 'net.ipv4.tcp_synack_retries',               value: '3' }
  - { variable: 'net.ipv4.tcp_syncookies',                   value: '1' }
  - { variable: 'net.ipv4.tcp_wmem',                         value: '4096 65536 33554432' }
  - { variable: 'vm.max_map_count',                          value: '262144' }